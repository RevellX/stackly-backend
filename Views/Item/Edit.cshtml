@model StacklyBackend.Models.Item

@{

    ViewData["Title"] = "Edit";
}
@section Styles {
    <link rel="stylesheet" href="~/css/forms.css" />
    <link rel="stylesheet" href="~/css/tables.css" />
}
<div class="entry-section">
    <a href="@Url.Action("Details", new { id = Model.Id})" class="btn-back" aria-label="Go back">
        <i class="fa-solid fa-chevron-left"></i>
    </a>
    <h2>Edit - @Model.Name</h2>
</div>

<div class="info-section">
    <p>Update item details below.</p>
</div>

<div class="form-container">
    <form-builder controller="Item" action="Edit" method="post" enctype="multipart/form-data">
        <input type="hidden" name="Id" value="@Model.Id" />
        <form-input-builder for="Name">
            Name
        </form-input-builder>
        <form-input-builder for="Description">
            Description
        </form-input-builder>
        <form-input-builder for="Quantity">
            Quantity
        </form-input-builder>
        <form-select-builder 
            for="CategoryId" 
            items="@(ViewData["categories"] as SelectList)"
            option-label="-- Select Category --">
            Category
        </form-select-builder>
        
        @if (Model.Files != null && Model.Files.Any())
        {
            <div class="stackly-form__field" style="margin-bottom: 1.5rem;">
                <label class="stackly-form__label">Current Photos</label>
                
                <div class="existing-files-grid">
                    @foreach (var file in Model.Files)
                    {
                        <div class="file-preview-item">
                            <img 
                                src="@Url.Action("Preview", "Item", new { fileId = file.Id })" 
                                alt="Item photo" 
                                loading="lazy" 
                            />
                            
                            <button type="button" class="btn-remove-file" title="Delete this photo" onclick="confirmDeletePhoto('@file.Id')">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                            @* <a href="@Url.Action("RemoveUpload", "Item", new { fileId = file.Id })"  *@
                            @*    class="btn-remove-file"  *@
                            @*    title="Delete this photo"> *@
                            @*     <i class="fa-solid fa-trash"></i> *@
                            @* </a> *@
                        </div>
                    }
                </div>
            </div>
        }

        <form-input-builder for="Files" type="file" multiple="true">
            Add New Photos <small style="color: var(--text-gray); font-weight: normal;">(Max 10MB)</small>
        </form-input-builder>
        <div class="form-actions" style="margin-top: 2rem;">
            <form-submit-builder>Save Changes</form-submit-builder>
        </div>
    </form-builder>
</div>


<script>
    function confirmDeletePhoto(fileId) {
        document.getElementById('deleteItemName').innerText = 'this photo';
        document.getElementById('deleteForm').action = '/Item/RemoveUpload?fileId=' + fileId;
        document.getElementById('deleteModal').style.display = 'flex';
    }
</script>




@* *@
@* *@
@* *@
@* *@
@* *@
@* <form action="/item/edit/@Model.Id" method="post" enctype="multipart/form-data"> *@
@*     @Html.AntiForgeryToken() *@
@*     <input type="hidden" id="Id" name="Id" value="@Model.Id" /> *@
@*     <div> *@
@*         <label for="Name">Name</label> *@
@*         <input type="text" id="Name" name="Name" value="@Model?.Name"/> *@
@*     </div> *@
@*     <div> *@
@*         <label for="Description">Description</label> *@
@*         <input type="text" id="Description" name="Description" value="@Model?.Description"/> *@
@*     </div> *@
@*     <div> *@
@*         <label for="Quantity">Quantity</label> *@
@*         <input type="text" id="Quantity" name="Quantity" value="@Model?.Quantity"/> *@
@*     </div> *@
@*     <div> *@
@*         <select name="CategoryId" id="CategoryId"> *@
@*             @foreach (var cat in (ViewData["categories"] as IEnumerable<StacklyBackend.Models.Category>) ?? Array.Empty<StacklyBackend.Models.Category>()) *@
@*             { *@
@*                 <option selected='@(Model?.CategoryId == cat.Id ? "selected" : null)' value="@cat.Id">@cat.Name</option> *@
@*             } *@
@*         </select> *@
@*     </div> *@
@*     <button type="submit">Edit</button> *@
@*     <p>Add new photos (max 10MB) :</p> *@
@*     <input  *@
@*         type="file"  *@
@*         name="Files" *@
@*         accept=".jpg, .jpeg, .png" *@
@*         multiple *@
@*     /> *@
@*     <button type="submit">Upload</button> *@
@* </form> *@
@* <p>Photos added:</p> *@
@* <ul> *@
@*     @foreach (var file in @Model.Files) *@
@*     { *@
@*         <li style="display: flex;"> *@
@*             <img  *@
@*                 src="@Url.Action("Preview", "Item", new { fileId = file.Id })"  *@
@*                 style="width: 250px; height: 160px; object-fit: cover;" *@
@*                 alt="@file.OriginalFileName" *@
@*                 loading="lazy" *@
@*             /> *@
@*             <div style="display: flex; flex-direction: column;"> *@
@*                 <a class="btn btn-sm btn-primary" *@
@*                     href="@Url.Action("Download", "Item", new { fileId = file.Id })"> *@
@*                     Download *@
@*                 </a> *@
@*                 <a *@
@*                     href="@Url.Action("RemoveUpload", "Item", new {fileId = file.Id})"> *@
@*                     Remove  *@
@*                 </a> *@
@*             </div> *@
@*         </li> *@
@*     } *@
@* </ul> *@