@model StacklyBackend.Models.Item

@{

    ViewData["Title"] = "Edit";
}
@section Styles {
    <link rel="stylesheet" href="~/css/forms.css" />
    <link rel="stylesheet" href="~/css/tables.css" />
}
<div class="entry-section">
    <a href="@Url.Action("Details", new { id = Model.Id})" class="btn-back" aria-label="Go back">
        <i class="fa-solid fa-chevron-left"></i>
    </a>
    <h2>Edit - @Model.Name</h2>
</div>

<div class="info-section">
    <p>Update item details below.</p>
</div>

<div class="form-container">
    <form-builder controller="Item" action="Edit" method="post" enctype="multipart/form-data">
        <input type="hidden" name="Id" value="@Model.Id" />
        <form-input-builder for="Name">
            Name
        </form-input-builder>
        <form-input-builder for="Description">
            Description
        </form-input-builder>
        <form-input-builder for="Quantity">
            Quantity
        </form-input-builder>
        <form-select-builder 
            for="CategoryId" 
            items="@(ViewData["categories"] as SelectList)"
            option-label="-- Select Category --">
            Category
        </form-select-builder>
        
        @if (Model.Files != null && Model.Files.Any())
        {
            <div class="stackly-form__field" style="margin-bottom: 1.5rem;">
                <label class="stackly-form__label">Current Photos</label>
                
                <div class="existing-files-grid">
                    @foreach (var file in Model.Files)
                    {
                        <div class="file-preview-item">
                            <img 
                                src="@Url.Action("Preview", "Item", new { fileId = file.Id })" 
                                alt="Item photo" 
                                loading="lazy" 
                            />
                            
                            <button type="button" class="btn-remove-file" title="Delete this photo" onclick="confirmDeletePhoto('@file.Id')">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                            @* <a href="@Url.Action("RemoveUpload", "Item", new { fileId = file.Id })"  *@
                            @*    class="btn-remove-file"  *@
                            @*    title="Delete this photo"> *@
                            @*     <i class="fa-solid fa-trash"></i> *@
                            @* </a> *@
                        </div>
                    }
                </div>
            </div>
        }

        <form-input-builder for="Files" type="file" multiple="true">
            Add New Photos <small style="color: var(--text-gray); font-weight: normal;">(Max 10MB)</small>
        </form-input-builder>
        <div class="form-actions" style="margin-top: 2rem;">
            <form-submit-builder>Save Changes</form-submit-builder>
        </div>
    </form-builder>
</div>


<script>
    function confirmDeletePhoto(fileId) {
        document.getElementById('deleteItemName').innerText = 'this photo';
        document.getElementById('deleteForm').action = '/Item/RemoveUpload?fileId=' + fileId;
        document.getElementById('deleteModal').style.display = 'flex';
    }
</script>